#!/bin/bash
echo "Checking dependencies:"

function check {
    echo -n "$1..."
    if ! command -v $1 >/dev/null 2>&1; then
        echo " not installed!"
        exit
    fi
    echo " ok."
}

check scion-ip-gateway
check docker
check docker-compose
check wg-quick

echo "Checking Python:"
printf "version "; python3 --version

mkdir -p build

cp /etc/scion/topology.json build
./etc/scionlab-config.py build/topology.json

if [ -z "$NODE" ]; then
    echo -n "Enter node identifier: "
    read NODE
fi
echo $NODE > build/nodename

echo "Downloading topology configuration..."
wget https://raw.githubusercontent.com/scion-backbone/config/master/nodes.json -O build/nodes.json